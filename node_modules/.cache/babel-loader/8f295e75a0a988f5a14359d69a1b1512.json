{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/admin/Desktop/frontend/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/admin/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/admin/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{createContext,useState,useEffect}from\"react\";import jwt_decode from\"jwt-decode\";import{useHistory}from\"react-router\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext();export default AuthContext;export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(function(){return localStorage.getItem(\"authTokens\")?JSON.parse(localStorage.getItem(\"authTokens\")):null;}),_useState2=_slicedToArray(_useState,2),authTokens=_useState2[0],setAuthTokens=_useState2[1];var _useState3=useState(function(){return localStorage.getItem(\"authTokens\")?jwt_decode(localStorage.getItem(\"authTokens\")):null;}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var history=useHistory();var loginUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.next=3;return fetch(\"http://127.0.0.1:8000/api/token/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({username:e.target.username.value,password:e.target.password.value})});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;if(response.status===200){setAuthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem(\"authTokens\",JSON.stringify(data));history.push(\"/\");}else{alert(\"Something went wrong!\");}case 8:case\"end\":return _context.stop();}}},_callee);}));return function loginUser(_x){return _ref2.apply(this,arguments);};}();var logoutUser=function logoutUser(){setAuthTokens(null);setUser(null);localStorage.removeItem(\"authToken\");history.push(\"/login\");};var updateToken=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(\"updated\");_context2.next=3;return fetch(\"http://127.0.0.1:8000/api/token/refresh/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({refresh:authTokens.refresh})});case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:data=_context2.sent;if(response.status===200){setAuthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem(\"authTokens\",JSON.stringify(data));}else{logoutUser();}case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function updateToken(){return _ref3.apply(this,arguments);};}();var contextData={user:user,loginUser:loginUser,logoutUser:logoutUser};useEffect(function(){var fourMinutes=1000*60*4;var interval=setInterval(function(){if(authTokens){updateToken();}},fourMinutes);return function(){return clearInterval(interval);};},[authTokens,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:children});};","map":{"version":3,"sources":["C:/Users/admin/Desktop/frontend/src/context/AuthContext.js"],"names":["createContext","useState","useEffect","jwt_decode","useHistory","AuthContext","AuthProvider","children","localStorage","getItem","JSON","parse","authTokens","setAuthTokens","user","setUser","loading","setLoading","history","loginUser","e","preventDefault","fetch","method","headers","body","stringify","username","target","value","password","response","json","data","status","access","setItem","push","alert","logoutUser","removeItem","updateToken","console","log","refresh","contextData","fourMinutes","interval","setInterval","clearInterval"],"mappings":"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","sourcesContent":["import { createContext, useState, useEffect } from \"react\";\nimport jwt_decode from \"jwt-decode\";\nimport { useHistory } from \"react-router\";\n\nconst AuthContext = createContext();\n\nexport default AuthContext;\n\nexport const AuthProvider = ({ children }) => {\n  let [authTokens, setAuthTokens] = useState(() =>\n    localStorage.getItem(\"authTokens\")\n      ? JSON.parse(localStorage.getItem(\"authTokens\"))\n      : null\n  );\n  let [user, setUser] = useState(() =>\n    localStorage.getItem(\"authTokens\")\n      ? jwt_decode(localStorage.getItem(\"authTokens\"))\n      : null\n  );\n\n  let [loading, setLoading] = useState(true);\n\n  const history = useHistory();\n\n  let loginUser = async (e) => {\n    e.preventDefault();\n\n    let response = await fetch(\"http://127.0.0.1:8000/api/token/\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        username: e.target.username.value,\n        password: e.target.password.value,\n      }),\n    });\n    let data = await response.json();\n    if (response.status === 200) {\n      setAuthTokens(data);\n      setUser(jwt_decode(data.access));\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\n      history.push(\"/\");\n    } else {\n      alert(\"Something went wrong!\");\n    }\n  };\n\n  let logoutUser = () => {\n    setAuthTokens(null);\n    setUser(null);\n    localStorage.removeItem(\"authToken\");\n    history.push(\"/login\");\n  };\n\n  let updateToken = async () => {\n    console.log(\"updated\");\n    let response = await fetch(\"http://127.0.0.1:8000/api/token/refresh/\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        refresh: authTokens.refresh,\n      }),\n    });\n    let data = await response.json();\n\n    if (response.status === 200) {\n      setAuthTokens(data);\n      setUser(jwt_decode(data.access));\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\n    } else {\n      logoutUser();\n    }\n  };\n\n  let contextData = {\n    user: user,\n    loginUser: loginUser,\n    logoutUser: logoutUser,\n  };\n\n  useEffect(() => {\n    let fourMinutes = 1000 * 60 * 4;\n    let interval = setInterval(() => {\n      if (authTokens) {\n        updateToken();\n      }\n    }, fourMinutes);\n    return () => clearInterval(interval);\n  }, [authTokens, loading]);\n\n  return (\n    <AuthContext.Provider value={contextData}>{children}</AuthContext.Provider>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}